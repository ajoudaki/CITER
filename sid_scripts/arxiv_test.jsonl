{"path": "/lustre/fsw/portfolios/llmservice/projects/llmservice_nemo_mlops/datasets/arxiv_final_categorized_redo/2210.15543/1-w_extraction.tex", "language": "EN", "adlr_id": "papers_en-arxiv_latex_text-0001204728", "text": "\\subsection{Proof of Lemma~\\ref{lem:qfstar_closedform}} From the KKT stationarity conditions: \\begin{align*} 0 &= d^D(s,a)\\lp \\gamma \\E_{s' \\sim P(\\cdot|s,a)}\\lb q_f^*(s',\\pi)\\rb - q_f^*(s,a)\\rp - \\nu(s,a) f'_{s,a}(w^\\pi(s,a)) \\end{align*} or in matrix form, letting $f'(w^\\pi)$ be shorthand for $[f'_{s,a}(w^\\pi(s,a))]_{s,a} \\in \\RR^{\\Scal\\times\\Acal}$, \\begin{align*} \\eta \\emult f'(w^\\pi) = d^D \\emult (I - \\gamma P^\\pi) q_f^* \\end{align*} Then $q_f^*$ must satisfy $$ (I - \\gamma P^\\pi) q_f^* = f'(w^\\pi) \\emult \\eta \\ediv d^D \\quad\\Longrightarrow\\quad q_f^* = (I - \\gamma P^\\pi)^{-1}(f'(w^\\pi) \\emult \\eta \\ediv d^D)$$\n\n\\subsection{Proof of Theorem~\\ref{thm:w_bound}} The proof is of a similar nature as the proof of Theorem~\\ref{thm:q_bound} (Appendix~\\ref{proof:q_bound}). From Assumption~\\ref{assum:regularizer_w} and Lemma~\\ref{lem:strongly_convex}, we know that that $L_f^w(w,q_f^*)$ is an $ M$-strongly convex function in $w$ on the $||\\cdot||_{2,\\eta}$ norm. Since $(w^\\pi, q_f^*)$ is the saddle point solution of $L_f^w$, from strong convexity we know that the error of $\\wh{w}$ is bounded as \\begin{align*} ||\\wh{w} - w^\\pi||_{2,d^D} &\\leq \\sqrt{\\frac{2\\lp L_f^w(w^\\pi, q_f^*) - L_f^w(\\wh{w}, q_f^*)\\rp}{M^w}} \\\\ &\\leq \\sqrt{\\frac{4\\epsilon_{stat}^w}{M^w}} &&\\text{(Lemma ~\\ref{lem:w_estimation_error})}, \\end{align*} where $\\epsilon_{stat}^w$ is given in Lemma~\\ref{lem:w_statistical_error}.\n\n\\begin{remark} In Theorem~\\ref{thm:w_bound} of the main text, there is an additional $O(\\nicefrac{C_f^w}{\\sqrt{n}})$ term in the statistical error $\\epsilon_{stat}^w$, which would arise if the regularization function $\\E_\\eta[f_{s,a}(w(s,a))]$ were to be estimated from samples. However, we state early on in the paper that we assume the regularizer can be calculated exactly, as sampling is a trivial extension. Correspondingly, the correct expression for the statistical error is: $$ \\epsilon_{stat}^w = (1+\\gamma) C_\\W^w C_\\Q^w \\sqrt{\\nicefrac{2\\log \\frac{4|\\Q||\\W|}{\\delta}}{n}} + (1-\\gamma)C_\\Q^w \\sqrt{\\nicefrac{2\\log \\frac{4|\\Q|}{\\delta}}{n_0}},$$ and, to remain consistent with the rest of the paper, we provide the proof and lemma for this $\\epsilon_{stat}^w$ below.\n\n\\end{remark}\n\n\\begin{lemma}\\label{lem:w_statistical_error} Suppose Assumption~\\ref{assum:bounded_w} holds. Then for all $(w,q) \\in \\W \\times \\Q$, w.p. $\\geq 1-\\delta$, \\begin{align*} |\\wh{L}^w_f(w,q) - L^w_f(w,q)| \\leq \\epsilon_{stat}^w, \\end{align*} where $\\epsilon_{stat}^w = (1+\\gamma) C_\\W^w C_\\Q^w \\sqrt\\frac{2\\log \\frac{4|\\Q||\\W|}{\\delta}}{n} + (1-\\gamma)C_\\Q^w \\sqrt\\frac{2\\log \\frac{4|\\Q|}{\\delta}}{n_0}$. \\end{lemma}\n\n\\begin{proof} Let $l_i = w(s_i, a_i)(\\gamma q(s_i', \\pi) - q(s_i, a_i))$. Using Assumption~\\ref{assum:bounded_w}, \\begin{align*} |l_i| &\\leq (1+\\gamma)||w||_\\infty ||q||_\\infty \\\\ &\\leq (1+\\gamma)C_\\W^w C_\\Q^w \\end{align*} Then using Hoeffding's inequality with union bound, w.p. $\\geq 1-\\delta/2$ we have that for all $w, q \\in \\W \\times \\Q$, \\begin{align*} \\lv \\frac{1}{n} \\sum_{i=1}^n l_i - \\E_{d^D}[l_i] \\rv \\leq (1+\\gamma)C_\\W^w C_\\Q^w \\sqrt{\\frac{2\\log \\frac{4|\\W||\\Q|}{\\delta}}{n}} \\end{align*}\n\nSimilarly, for all $q \\in \\Q$, w.p. $\\geq 1-\\delta/2$, \\begin{align*} \\lv \\frac{1}{n_0} \\sum_{i=1}^{n_0} q(s_{0,i}, \\pi) - \\E_{\\mu_0}[q(s_{0,i}, \\pi)] \\rv \\leq C_\\Q^w \\sqrt{\\frac{2\\log \\frac{4|\\Q|}{\\delta}}{n_0}} \\end{align*}\n\nSince $L_f^w(w,q) = \\E_\\eta[f_{s,a}(w(s,a))] + \\E_{d^D}[l_i] + \\E_{\\init}[q(s_0, \\pi)]$, but the first term can be calculated exactly, taking a union bound over the above two inequalities, we have that w.p. $\\geq 1-\\delta$, \\begin{align*} |\\wh{L}_f^w(w,q) - L_f^w(w,q)| &\\leq (1+\\gamma)C_\\W^w C_\\Q^w \\sqrt\\frac{2\\log \\frac{4|\\Q||\\W|}{\\delta}}{n} + (1-\\gamma)C_\\Q^w \\sqrt\\frac{2\\log \\frac{4|\\Q|}{\\delta}}{n_0} \\end{align*} \\end{proof}\n\n\\begin{lemma}\\label{lem:w_estimation_error} Under Assumptions~\\ref{assum:regularizer_w},~\\ref{assum:realizable_w},~\\ref{assum:bounded_w}, w.p. $\\geq 1-\\delta$, \\begin{align*} L_f^w(w_f^*, q_f^*) - L_f^w(\\wh{w}, q_f^*) \\leq 2 \\epsilon_{stat}^w \\end{align*} \\end{lemma}\n\n\\paragraph{Proof of Lemma~\\ref{lem:w_estimation_error}} Letting $\\wh{q}(w) = \\argmax_{q \\in \\Qcal} \\wh{L}_f^w(w, q)$, we decompose the error as follows: \\begin{align*} L_f^w(\\wh{w}, q_f^{*}) - L_f^w(w^\\pi, q_f^{*}) &= L_f^w(\\wh{w}, q_f^{*}) - \\wh{L}_f(\\wh{w}, q_f^{*}) &&\\text{(1) }\\geq -\\epsilon_{stat}^w \\\\\n\n&+ \\wh{L}_f^w(\\wh{w}, q_f^{*}) - \\wh{L}_f^w(\\wh{w}, \\wh{q}(\\wh{w}))&&\\text{(2) } \\geq 0 \\\\\n\n&+ \\wh{L}_f^w(\\wh{w}, \\wh{q}(\\wh{w})) - \\wh{L}_f^w(w^\\pi, \\wh{q}(w^\\pi))&&\\text{(3) }\\geq 0 \\\\\n\n&+ \\wh{L}_f^w(w^\\pi, \\wh{q}(w^\\pi)) - L^w_f (w^\\pi, \\wh{q}(w^\\pi)&&\\text{(4) }\\geq -\\epsilon_{stat}^w \\\\\n\n&+ L^w_f (w^\\pi, \\wh{q}(w^\\pi)) - L^w_f (w^\\pi, q_f^{*}) &&\\text{(5) }\\geq 0 \\end{align*} Combining the inequalities gives the result. We give a brief justification for each term below. Terms (1) and (4) follow from Lemma~\\ref{lem:w_statistical_error}.\n\nTerm (2) $\\geq 0$, since $q_f^{*} \\in \\Q$.\n\nTerm (3) $\\geq 0$ since $w^\\pi \\in \\W$ and $\\wh{w} = \\argmax_{w \\in \\W} \\wh{L}_f^w(w, \\wh{q}(w))$.\n\nTerm (5) $\\geq 0$ since $(w^\\pi, q_f^{*})$ is a saddle point solution.", "kenlm_perplexity": 695197.0769916825, "kenlm_sp_perplexity": 45.18891856542589}
